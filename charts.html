<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charts - RoyalTraders</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Chart.js Financial Plugin for Candlestick -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.0/dist/chartjs-chart-financial.min.js"></script>
</head>
<body>
    <header class="top-header">
        <div class="header-left">
            <svg class="logo" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7V17L12 22L22 17V7L12 2ZM12 4.144L20 8.5L12 12.856L4 8.5L12 4.144ZM4 10.5L11 14.5V20.856L4 16.5V10.5ZM13 14.5L20 10.5V16.5L13 20.856V14.5Z"/>
            </svg>
            <span class="logo-text">RoyalTraders</span>
        </div>
        <div class="header-right">
            <button class="btn btn-secondary">Log In</button>
            <button class="btn btn-primary">Sign Up</button>
        </div>
    </header>

    <nav class="main-nav">
        <div class="nav-links-container">
            <a href="index.html" class="nav-link" data-page="index.html" aria-label="Dashboard"><i class="fa-solid fa-home"></i><span>Dashboard</span></a>
            <a href="bot-builder.html" class="nav-link" data-page="bot-builder.html" aria-label="Bot Builder"><i class="fa-solid fa-hammer"></i><span>Bot Builder</span></a>
            <a href="analysis-tool.html" class="nav-link" data-page="analysis-tool.html" aria-label="Analysis Tool"><i class="fa-solid fa-chart-line"></i><span>Analysis Tool</span></a>
            <a href="batch-trader.html" class="nav-link" data-page="batch-trader.html" aria-label="Batch Trader"><i class="fa-solid fa-layer-group"></i><span>Batch Trader</span></a>
            <a href="market-analyzer.html" class="nav-link" data-page="market-analyzer.html" aria-label="Market Analyzer"><i class="fa-solid fa-chart-area"></i><span>Market Analyzer</span></a>
            <a href="frequency-analysis.html" class="nav-link" data-page="frequency-analysis.html" aria-label="Frequency Analysis"><i class="fa-solid fa-calculator"></i><span>Frequency Analysis</span></a>
            <a href="digit-tool.html" class="nav-link" data-page="digit-tool.html" aria-label="Digit Tool"><i class="fa-solid fa-fingerprint"></i><span>Digit Tool</span></a>
            <a href="free-bots.html" class="nav-link" data-page="free-bots.html" aria-label="Free Bots"><i class="fa-solid fa-robot"></i><span>Free Bots</span></a>
            <a href="copy-trader.html" class="nav-link" data-page="copy-trader.html" aria-label="Copy Trader"><i class="fa-solid fa-copy"></i><span>Copy Trader</span></a>
            <a href="charts.html" class="nav-link active" data-page="charts.html" aria-label="Charts"><i class="fa-solid fa-chart-bar"></i><span>Charts</span></a>
        </div>
        <div class="nav-right-actions">
            <span id="statusTag" class="status-tag">Not Running</span>
            <button id="runButton" class="btn btn-run"><i class="fa-solid fa-play"></i><span class="btn-text">Run Bot</span></button>
        </div>
    </nav>

    <main id="mainContent" class="main-content">
        <div data-page-content="charts.html">
            <section class="section">
                <h1 class="page-heading">Charts</h1>
                <p class="page-subheading">Visualize price movements with customizable charts and indicators.</p>
                <div class="card analysis-container">
                    <div class="controls-bar">
                        <div class="filter-group">
                            <label for="assetChart">Asset:</label>
                            <select id="assetChart">
                                <option value="EURUSD">EUR/USD</option>
                                <option value="GBPJPY">GBP/JPY</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Indicators:</label>
                            <div class="indicator-toggles">
                                <input type="checkbox" id="sma"> <label for="sma">SMA</label>
                                <input type="checkbox" id="ema"> <label for="ema">EMA</label>
                                <input type="checkbox" id="rsi"> <label for="rsi">RSI</label>
                            </div>
                        </div>
                    </div>
                    <div class="chart-area card">
                        <canvas id="mainChart" style="width: 100%; height: 400px;"></canvas>
                    </div>
                </div>
                <h2 class="section-title mt-2">Historical Prices</h2>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Open</th>
                                <th>High</th>
                                <th>Low</th>
                                <th>Close</th>
                            </tr>
                        </thead>
                        <tbody id="historicalTable">
                            <tr><td>2025-08-30</td><td>1.0870</td><td>1.0895</td><td>1.0865</td><td>1.0872</td></tr>
                            <tr><td>2025-08-29</td><td>1.0855</td><td>1.0875</td><td>1.0850</td><td>1.0870</td></tr>
                            <tr><td>2025-08-28</td><td>1.0860</td><td>1.0865</td><td>1.0840</td><td>1.0855</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </main>

    <div class="warning-bar">
        <strong>Disclaimer:</strong> Trading involves risk. All analysis tools and bots are for informational purposes only.
    </div>

    <footer class="main-footer">
        <div class="footer-left">
            <span id="dateTime"></span>
        </div>
        <div class="footer-right">
            <button id="settingsToggle" class="footer-btn" aria-label="Settings"><i class="fa-solid fa-cog"></i></button>
            <button id="darkModeToggle" class="footer-btn" aria-label="Toggle dark/light mode"><i class="fa-solid fa-moon"></i></button>
            <div class="language-select">
                <button class="footer-btn" aria-label="Select language"><i class="fa-solid fa-globe"></i></button>
                <i class="fa-solid fa-caret-down"></i>
            </div>
        </div>
    </footer>

    <script>
        // Initial chart data
        const chartData = [
            { time: '2025-08-28', open: 1.0860, high: 1.0865, low: 1.0840, close: 1.0855 },
            { time: '2025-08-29', open: 1.0855, high: 1.0875, low: 1.0850, close: 1.0870 },
            { time: '2025-08-30', open: 1.0870, high: 1.0895, low: 1.0865, close: 1.0872 },
        ];

        // Initialize Chart.js
        const ctx = document.getElementById('mainChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'candlestick',
            data: {
                datasets: [{
                    label: 'Candlestick',
                    data: chartData.map(d => ({
                        x: new Date(d.time).getTime(),
                        o: d.open,
                        h: d.high,
                        l: d.low,
                        c: d.close
                    })),
                    borderColor: '#000000',
                    color: {
                        up: '#26a69a',
                        down: '#ef5350'
                    }
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'day'
                        },
                        title: { display: true, text: 'Date' }
                    },
                    y: {
                        title: { display: true, text: 'Price' },
                        beginAtZero: false
                    }
                }
            }
        });

        // Indicator calculations
        function calculateSMA(data, period = 14) {
            const sma = [];
            for (let i = period - 1; i < data.length; i++) {
                const sum = data.slice(i - period + 1, i + 1).reduce((acc, val) => acc + val.close, 0);
                sma.push({ x: new Date(data[i].time).getTime(), y: sum / period });
            }
            return sma;
        }

        function calculateEMA(data, period = 14) {
            const ema = [];
            const multiplier = 2 / (period + 1);
            let prevEma = data[0].close;
            ema.push({ x: new Date(data[0].time).getTime(), y: prevEma });
            for (let i = 1; i < data.length; i++) {
                const currentEma = (data[i].close - prevEma) * multiplier + prevEma;
                ema.push({ x: new Date(data[i].time).getTime(), y: currentEma });
                prevEma = currentEma;
            }
            return ema;
        }

        function calculateRSI(data, period = 14) {
            const rsi = [];
            let avgGain = 0, avgLoss = 0;
            for (let i = 1; i < data.length; i++) {
                const change = data[i].close - data[i - 1].close;
                const gain = change > 0 ? change : 0;
                const loss = change < 0 ? -change : 0;
                if (i <= period) {
                    avgGain += gain / period;
                    avgLoss += loss / period;
                } else {
                    avgGain = (avgGain * (period - 1) + gain) / period;
                    avgLoss = (avgLoss * (period - 1) + loss) / period;
                    const rs = avgGain / (avgLoss || 1);
                    const rsiValue = 100 - (100 / (1 + rs));
                    rsi.push({ x: new Date(data[i].time).getTime(), y: rsiValue });
                }
            }
            return rsi;
        }

        // Update indicators
        function updateIndicators() {
            const datasets = [{
                label: 'Candlestick',
                type: 'candlestick',
                data: chartData.map(d => ({
                    x: new Date(d.time).getTime(),
                    o: d.open,
                    h: d.high,
                    l: d.low,
                    c: d.close
                })),
                borderColor: '#000000',
                color: { up: '#26a69a', down: '#ef5350' }
            }];

            if (document.getElementById('sma').checked) {
                datasets.push({
                    label: 'SMA',
                    type: 'line',
                    data: calculateSMA(chartData),
                    borderColor: '#2962FF',
                    fill: false,
                    pointRadius: 0
                });
            }

            if (document.getElementById('ema').checked) {
                datasets.push({
                    label: 'EMA',
                    type: 'line',
                    data: calculateEMA(chartData),
                    borderColor: '#FF6D00',
                    fill: false,
                    pointRadius: 0
                });
            }

            if (document.getElementById('rsi').checked) {
                datasets.push({
                    label: 'RSI',
                    type: 'line',
                    data: calculateRSI(chartData),
                    borderColor: '#E91E63',
                    fill: false,
                    pointRadius: 0,
                    yAxisID: 'rsi'
                });
            }

            chart.data.datasets = datasets;
            chart.options.scales = {
                x: { type: 'time', time: { unit: 'day' }, title: { display: true, text: 'Date' } },
                y: { title: { display: true, text: 'Price' }, beginAtZero: false },
                rsi: document.getElementById('rsi').checked ? {
                    title: { display: true, text: 'RSI' },
                    position: 'right',
                    min: 0,
                    max: 100
                } : undefined
            };
            chart.update();
        }

        // Event listeners
        document.getElementById('assetChart').addEventListener('change', (e) => {
            // Placeholder for future WebSocket or data fetch based on asset
            console.log('Selected asset:', e.target.value);
            // For now, no data change since WebSocket is commented out
        });

        document.getElementById('sma').addEventListener('change', updateIndicators);
        document.getElementById('ema').addEventListener('change', updateIndicators);
        document.getElementById('rsi').addEventListener('change', updateIndicators);

        // Commented WebSocket code for future implementation
        /*
        let ws;
        function connectWebSocket(symbol) {
            if (ws) ws.close();
            ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol.toLowerCase()}@kline_1m`);
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                const kline = data.k;
                if (kline.x) { // Closed kline
                    const newCandle = {
                        time: Math.floor(kline.t / 1000),
                        open: parseFloat(kline.o),
                        high: parseFloat(kline.h),
                        low: parseFloat(kline.l),
                        close: parseFloat(kline.c)
                    };
                    chartData.push(newCandle);
                    chart.data.datasets[0].data.push({
                        x: new Date(newCandle.time).getTime(),
                        o: newCandle.open,
                        h: newCandle.high,
                        l: newCandle.low,
                        c: newCandle.close
                    });
                    chart.update();

                    // Update historical table
                    const tbody = document.getElementById('historicalTable');
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${new Date(kline.t).toISOString().split('T')[0]}</td>
                        <td>${newCandle.open.toFixed(4)}</td>
                        <td>${newCandle.high.toFixed(4)}</td>
                        <td>${newCandle.low.toFixed(4)}</td>
                        <td>${newCandle.close.toFixed(4)}</td>
                    `;
                    tbody.insertBefore(row, tbody.firstChild);
                    if (tbody.children.length > 10) tbody.removeChild(tbody.lastChild);

                    updateIndicators();
                }
            };
            ws.onerror = (error) => console.error('WebSocket error:', error);
            ws.onclose = () => console.log('WebSocket closed');
        }

        // Initial WebSocket connection
        connectWebSocket('eurusdt');
        */

        // Update dateTime in footer
        function updateDateTime() {
            const now = new Date();
            document.getElementById('dateTime').textContent = now.toLocaleString();
        }
        setInterval(updateDateTime, 1000);
        updateDateTime();

        // Initial chart render
        updateIndicators();
    </script>
</body>
</html>