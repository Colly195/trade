<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - RoyalTraders</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        .hidden {
            display: none !important;
        }
        
        /* New CSS for the WebSocket section */
        .live-price-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #live-price {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .digits-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
        }

        .digit-chip {
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 50%;
            color: white;
            transition: background-color 0.3s;
        }

        .digit-chip.even {
            background-color: #3498db; /* Blue */
        }

        .digit-chip.odd {
            background-color: #e74c3c; /* Red */
        }
        
        .counts-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .count-chip {
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            color: white;
        }
        
        .even-count-chip {
            background-color: #3498db;
        }
        
        .odd-count-chip {
            background-color: #e74c3c;
        }
    </style>
</head>
<body>
    <header class="top-header">
        <div class="header-left">
            <svg class="logo" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7V17L12 22L22 17V7L12 2ZM12 4.144L20 8.5L12 12.856L4 8.5L12 4.144ZM4 10.5L11 14.5V20.856L4 16.5V10.5ZM13 14.5L20 10.5V16.5L13 20.856V14.5Z"/>
            </svg>
            <span class="logo-text">RoyalTraders</span>
        </div>
        <div class="header-right">
            <div id="user-display" class="user-info-container hidden">
                <div id="user-initials" style="background-color: #5c6bc0; color: #fff; width: 35px; height: 35px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold;"></div>
                <img id="country-flag" src="" alt="Country Flag" style="width: 30px; height: auto;">
                <span id="user-balance" style="font-weight: bold;"></span>
                <button id="logout-btn" class="btn btn-secondary btn-sm" style="margin-left: 10px;">Log Out</button>
            </div>
            <div id="auth-links" class="auth-links-container">
                <button id="deriv-auth-btn" class="btn btn-secondary">Log in / Sign up with Deriv</button>
            </div>
        </div>
    </header>

    <nav class="main-nav">
        <div class="nav-links-container">
            <a href="index.html" class="nav-link active" aria-label="Dashboard" data-page="index.html"><i class="fa-solid fa-home"></i><span>Dashboard</span></a>
            <a href="bot-builder.html" class="nav-link" aria-label="Bot Builder" data-page="bot-builder.html"><i class="fa-solid fa-hammer"></i><span>Bot Builder</span></a>
            <a href="analysis-tool.html" class="nav-link" aria-label="Analysis Tool" data-page="analysis-tool.html"><i class="fa-solid fa-chart-line"></i><span>Analysis Tool</span></a>
            <a href="batch-trader.html" class="nav-link" aria-label="Batch Trader" data-page="batch-trader.html"><i class="fa-solid fa-layer-group"></i><span>Batch Trader</span></a>
            <a href="market-analyzer.html" class="nav-link" aria-label="Market Analyzer" data-page="market-analyzer.html"><i class="fa-solid fa-chart-area"></i><span>Market Analyzer</span></a>
            <a href="frequency-analysis.html" class="nav-link" aria-label="Frequency Analysis" data-page="frequency-analysis.html"><i class="fa-solid fa-calculator"></i><span>Frequency Analysis</span></a>
            <a href="digit-tool.html" class="nav-link" aria-label="Digit Tool" data-page="digit-tool.html"><i class="fa-solid fa-fingerprint"></i><span>Digit Tool</span></a>
            <a href="free-bots.html" class="nav-link" aria-label="Free Bots" data-page="free-bots.html"><i class="fa-solid fa-robot"></i><span>Free Bots</span></a>
            <a href="copy-trader.html" class="nav-link" aria-label="Copy Trader" data-page="copy-trader.html"><i class="fa-solid fa-copy"></i><span>Copy Trader</span></a>
            <a href="charts.html" class="nav-link" aria-label="Charts" data-page="charts.html"><i class="fa-solid fa-chart-bar"></i><span>Charts</span></a>
        </div>
        <div class="nav-right-actions">
            <span id="statusTag" class="status-tag not-running">Not Running</span>
            <button id="runButton" class="btn btn-run"><i class="fa-solid fa-play"></i><span id="runBtnText" class="btn-text">Run</span></button>
        </div>
    </nav>

    <main class="main-content">
        <div class="announcement-card card">
            <p><strong>ðŸš¨ New Feature!</strong> The new Batch Trader is now live. Upload your trades in bulk.</p>
            <button class="close-btn" aria-label="Dismiss announcement"><i class="fa-solid fa-xmark"></i></button>
        </div>
        
        <section class="section">
            <h2 class="section-title">Live Volatility 100 Index Data</h2>
            <div class="grid-container">
                <div class="card grid-card live-price-card">
                    <h3>Live Price</h3>
                    <div id="live-price">--</div>
                </div>
                <div class="card grid-card">
                    <h3>Last Digits History</h3>
                    <div id="digits-container" class="digits-container"></div>
                </div>
                <div class="card grid-card">
                    <h3>Even/Odd Count</h3>
                    <div class="counts-container">
                        <div class="count-chip even-count-chip">
                            Even: <span id="even-count">0</span>
                        </div>
                        <div class="count-chip odd-count-chip">
                            Odd: <span id="odd-count">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="section">
            <h2 class="section-title">Live Market Data</h2>
            <div class="table-container card">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Asset</th>
                            <th>Price</th>
                            <th>Volume</th>
                            <th>% Change</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-asset="frxEURUSD">
                            <td>EUR/USD</td>
                            <td id="priceEURUSD">1.0872</td>
                            <td>2.1M</td>
                            <td id="changeEURUSD" class="positive">+0.5%</td>
                        </tr>
                        <tr data-asset="frxGBPJPY">
                            <td>GBP/JPY</td>
                            <td id="priceGBPJPY">180.45</td>
                            <td>1.5M</td>
                            <td id="changeGBPJPY" class="negative">-0.2%</td>
                        </tr>
                        <tr data-asset="frxUSDJPY">
                            <td>USD/JPY</td>
                            <td id="priceUSDJPY">148.91</td>
                            <td>3.2M</td>
                            <td id="changeUSDJPY" class="positive">+0.8%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title">Load Bot</h2>
            <div class="grid-container">
                <div class="card grid-card">
                    <i class="fa-solid fa-desktop grid-icon"></i>
                    <h3>My Computer</h3>
                    <p>Load a bot file from your local machine.</p>
                </div>
                <div class="card grid-card">
                    <i class="fa-brands fa-google-drive grid-icon"></i>
                    <h3>Google Drive</h3>
                    <p>Access your stored bots from Google Drive.</p>
                </div>
                <div class="card grid-card">
                    <i class="fa-solid fa-hammer grid-icon"></i>
                    <h3>Bot Builder</h3>
                    <p>Start from scratch in the bot builder.</p>
                </div>
                <div class="card grid-card">
                    <i class="fa-solid fa-bolt grid-icon"></i>
                    <h3>Quick Strategy</h3>
                    <p>Build a simple bot with predefined settings.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title">Your Bots</h2>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Bot Name</th>
                            <th>Last Modified</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Scalping King ðŸ‘‘</td>
                            <td>2025-08-30</td>
                            <td><span class="status-tag running">Running</span></td>
                            <td>
                                <button class="btn btn-sm btn-action" data-action="view" aria-label="View Bot"><i class="fa-solid fa-eye"></i></button>
                                <button class="btn btn-sm btn-action" data-action="copy" aria-label="Copy Bot"><i class="fa-solid fa-copy"></i></button>
                                <button class="btn btn-sm btn-action" data-action="delete" aria-label="Delete Bot"><i class="fa-solid fa-trash"></i></button>
                            </td>
                        </tr>
                        <tr>
                            <td>Trend Follower</td>
                            <td>2025-08-25</td>
                            <td><span class="status-tag not-running">Not Running</span></td>
                            <td>
                                <button class="btn btn-sm btn-action" data-action="view" aria-label="View Bot"><i class="fa-solid fa-eye"></i></button>
                                <button class="btn btn-sm btn-action" data-action="copy" aria-label="Copy Bot"><i class="fa-solid fa-copy"></i></button>
                                <button class="btn btn-sm btn-action" data-action="delete" aria-label="Delete Bot"><i class="fa-solid fa-trash"></i></button>
                            </td>
                        </tr>
                        <tr>
                            <td>EMA Cross</td>
                            <td>2025-08-19</td>
                            <td><span class="status-tag not-running">Not Running</span></td>
                            <td>
                                <button class="btn btn-sm btn-action" data-action="view" aria-label="View Bot"><i class="fa-solid fa-eye"></i></button>
                                <button class="btn btn-sm btn-action" data-action="copy" aria-label="Copy Bot"><i class="fa-solid fa-copy"></i></button>
                                <button class="btn btn-sm btn-action" data-action="delete" aria-label="Delete Bot"><i class="fa-solid fa-trash"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <div class="warning-bar">
        <strong>Disclaimer:</strong> Trading involves risk. All analysis tools and bots are for informational purposes only.
    </div>

    <footer class="main-footer">
        <div class="footer-left">
            <span id="dateTime"></span>
        </div>
        <div class="footer-right">
            <button id="settingsToggle" class="footer-btn" aria-label="Settings"><i class="fa-solid fa-cog"></i></button>
            <button id="darkModeToggle" class="footer-btn" aria-label="Toggle dark/light mode"><i class="fa-solid fa-moon"></i></button>
            <div class="language-select">
                <button class="footer-btn" aria-label="Select language"><i class="fa-solid fa-globe"></i></button>
                <i class="fa-solid fa-caret-down"></i>
            </div>
        </div>
    </footer>

    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            const derivAuthBtn = document.getElementById('deriv-auth-btn');
            const userDisplay = document.getElementById('user-display');
            const authLinks = document.getElementById('auth-links');
            const logoutBtn = document.getElementById('logout-btn');

            // Your Deriv App ID
            const APP_ID = '99626';

            // Event listener for the "Log in / Sign up" button
            if (derivAuthBtn) {
                derivAuthBtn.addEventListener('click', () => {
                    const oauthUrl = `https://oauth.deriv.com/oauth2/authorize?app_id=${APP_ID}&l=en&brand=deriv`;
                    window.location.href = oauthUrl;
                });
            }

            // Event listener for the "Log Out" button
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    sessionStorage.removeItem('deriv_token');
                    updateUIForLoginState(false);
                    // Redirect to the homepage or reload the page
                    window.location.href = 'index.html';
                });
            }

            // Function to handle login state
            function updateUIForLoginState(isLoggedIn) {
                if (isLoggedIn) {
                    authLinks.classList.add('hidden');
                    userDisplay.classList.remove('hidden');
                } else {
                    authLinks.classList.remove('hidden');
                    userDisplay.classList.add('hidden');
                }
            }

            // Check URL for Deriv token after redirect
            const params = new URLSearchParams(window.location.search);
            const token = params.get('token');
            
            if (token) {
                // If a token exists, the user is logged in
                sessionStorage.setItem('deriv_token', token);
                updateUIForLoginState(true);
                // Clean the URL by removing the token for security and a cleaner look
                window.history.replaceState({}, document.title, window.location.pathname);
            } else {
                // Check if a token already exists in session storage
                const storedToken = sessionStorage.getItem('deriv_token');
                if (storedToken) {
                    updateUIForLoginState(true);
                } else {
                    updateUIForLoginState(false);
                }
            }
        });
    </script>
</body>
</html>
